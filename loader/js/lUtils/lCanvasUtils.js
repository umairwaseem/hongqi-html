function lFillColor(e,d,a,g,c,f){var b=e.getContext("2d");b.fillStyle=d;b.fillRect(a,g,c,f)}lCanvasUtils={};lCanvasUtils.tmpCanvas=document.createElement("canvas");lCanvasUtils.tmpCtx=lCanvasUtils.tmpCanvas.getContext("2d");function lCreateImageData(a,b){return lCanvasUtils.tmpCtx.createImageData(a,b)}function lSetImgDateAlpha(g,c){if(c==undefined){c=1}var a=lCreateImageData(g.width,g.height);var f=a.data;var e=g.data;for(var b=0;b<e.length;b+=4){f[b]=e[b];f[b+1]=e[b+1];f[b+2]=e[b+2];f[b+3]=e[b+3]*c}return a}function lFillText(b,e,n){if(n==undefined){n=false}var h=lSpan(b.innerHTML);h.style.cssText=b.style.cssText;var g=h.innerHTML;var a="";for(var m=0;m<g.length;m++){a+="<span>"+g[m]+"</span>"}h.innerHTML=a;TweenMax.to(h,0,{alpha:0});document.body.appendChild(h);if(h.style.left==undefined){var d=0}else{var d=parseInt(h.style.left)}if(h.style.top==undefined){var c=0}else{var c=parseInt(h.style.top)}if(h.style.fontSize==undefined){var j=0}else{var j=parseInt(h.style.fontSize)}if(h.style.color==undefined){var l=0}else{var l=h.style.color}if(h.style.fontFamily==undefined){var o=0}else{var o=h.style.fontFamily}if(h.style.fontWeight==undefined){var f="normal"}else{var f=h.style.fontWeight}var k=e.getContext("2d");k.font=f+" "+lCheckUnit(j)+" "+o;k.fillStyle=l;var s;var r;var q=h.offsetLeft;var p=h.offsetTop;for(var m=0;m<h.childNodes.length;m++){s=h.childNodes[m].offsetLeft;r=h.childNodes[m].offsetTop;k.fillText(h.childNodes[m].innerHTML,s+q,r+j+p)}lRemoveChild(h);h.innerHTML="";if(n==true){lRemoveChild(b);b.innerHTML=""}}function lCvsImg(c,f,e,a,h){if(c.localName=="img"){if(c.src==""||c.complete==false){c.addEventListener("load",d)}else{d()}}else{if(typeof(c)=="string"){var g=c;if(g.indexOf(".")!=-1){if(g.indexOf("?")==-1){g+="?rtime="+Math.random()}else{g+="&rtime="+Math.random()}}c=lImg(undefined,e,a,h);if(g.indexOf("data:image")==-1){c.crossOrigin="anonymous"}c.src=g;c.addEventListener("load",d);var b=lTimesEf(function(){if(c.complete==true){d()}},0.1,10);b.start()}else{d()}}function d(){if(b!=undefined){b.stop()}try{c.removeEventListener("load",d)}catch(i){}TweenMax.delayedCall(0.01,function(){if(f!=undefined){f(c)}})}return c}function lDrawImage(g,d,j,i,e){if(e==undefined){e={}}if(e.cPX==undefined){e.cPX=0.5}if(e.cPY==undefined){e.cPY=0.5}if(e.tR==undefined){e.tR=0}if(e.tScaleX==undefined){e.tScaleX=1}if(e.tScaleY==undefined){e.tScaleY=1}if(j==undefined){j=0}if(i==undefined){i=0}var l=e.cPX;var k=e.cPY;var c=e.tR;var b=e.tScaleX;var a=e.tScaleY;var f=lCvsImg(d,h);function h(o){if(e.tW==undefined){e.tW=o.width}if(e.tH==undefined){e.tH=o.height}var p=o.width;var r=o.height;var m=g.getContext("2d");var n=p*l;var s=r*k;try{m.save();m.translate(j,i);m.translate(n,s);m.rotate(c*Math.PI/180);m.scale(b,a);m.translate(-n,-s);m.drawImage(o,0,0,e.tW,e.tH);m.restore()}catch(q){}if(e.onComplete!=undefined){e.onComplete()}}}function lCopyAlphaChannelToCanvas(d,e){var c=d.getContext("2d").getImageData(0,0,d.width,d.height);var b=e.getContext("2d").getImageData(0,0,d.width,d.height);for(var a=0;a<c.data.length;a+=4){c.data[a+3]=b.data[a+3]}d.getContext("2d").putImageData(c,0,0)}function lCloneCvs(e,d,c,b){var a=lCanvas(d,c,b,e.width,e.height);a.c2d.putImageData(e.getContext("2d").getImageData(0,0,e.width,e.height),0,0);return a}function lFillColorByImg(c,b,a){c.c2d.save();c.c2d.globalCompositeOperation="source-over";c.c2d.fillStyle=b;c.c2d.fillRect(0,0,c.width,c.height);c.c2d.globalCompositeOperation="destination-in";c.c2d.drawImage(a,0,0);c.c2d.restore()}function lTintColor(b,e,c){if(c==undefined){c=1}var l=lHex2rgb(e);var a=lCreateImageData(b.width,b.height);var m=b.width;var g=b.height;var k=a.data;var j=b.data;for(var f=0;f<j.length;f+=4){k[f]=j[f]+(l.r-j[f])*c;k[f+1]=j[f+1]+(l.g-j[f+1])*c;k[f+2]=j[f+2]+(l.b-j[f+2])*c;k[f+3]=j[f+3]}return a}function lImgToCanvas(e,i,c,h,d,b){var f=lCvsImg(e,g);var a=lCanvas(i,c,h);function g(){a.width=f.width;a.height=f.height;if(b==undefined){b={}}if(d!=undefined){b.onComplete=function(){d()}}lDrawImage(a,e,0,0,b)}return a}function lCvsErase(v,o,n,q,F,m){if(m==undefined){m={}}if(m.mbfixX==undefined){m.mbfixX=0}if(m.mbfixY==undefined){m.mbfixY=0}if(m.ef_darkAlpha==undefined){m.ef_darkAlpha=1}if(m.drawD==undefined){m.drawD=25}if(m.doEf==undefined){m.doEf=false}if(m.ef_light==undefined){m.ef_light=1.2}if(m.ef_dark==undefined){m.ef_dark=0.9}if(m.ef_blur==undefined){m.ef_blur=3}if(m.ef_d==undefined){m.ef_d=5}if(m.ef_lightAlpha==undefined){m.ef_lightAlpha=1}if(m.ef_darkAlpha==undefined){m.ef_darkAlpha=1}m.ef_lightColor;m.ef_darkColor;m.onEptCheck;var j=lDiv(v,o,n,q,F);var r=lCanvas(j,0,0,q,F);var C=r.getContext("2d");if(m.doEf==true){var l=lCanvas(j,0,0,q,F);l.style.pointerEvents="none";TweenMax.to(l,0,{autoAlpha:m.ef_lightAlpha,webkitFilter:"brightness("+m.ef_light+") blur("+m.ef_blur+"px)"});var J=lCanvas(j,0,0,q,F);J.style.pointerEvents="none";TweenMax.to(J,0,{autoAlpha:m.ef_darkAlpha,webkitFilter:"brightness("+m.ef_dark+") blur("+m.ef_blur+"px)"})}if(lIsMobile()==true){r.addEventListener("touchmove",B);r.addEventListener("touchstart",i);r.addEventListener("touchend",f)}else{r.addEventListener("mousemove",B);r.addEventListener("mousedown",i);r.addEventListener("mouseup",f);r.addEventListener("mouseleave",f)}var M;var K;var z;var u;var g=false;var L=0;function B(O){if(g==true&&s==true){if(lIsMobile()==true){M=parseInt(O.touches[0].pageX)+m.mbfixX;K=parseInt(O.touches[0].pageY)+m.mbfixY}else{M=O.offsetX;K=O.offsetY}if(z!=undefined){var Q=lPDistance(lPoint(M,K),lPoint(z,u));if(Q>=m.drawD*2){var p=m.drawD/Q;var y=parseInt(Q/m.drawD);var P;var x;var w;for(var h=0;h<y;h++){x=p*(h+1);P=lRatioTo({x:M,y:K},{x:z,y:u},x);H(P.x,P.y,360*Math.random())}}}H(M,K,360*Math.random());if(m.doEf==true){t()}L+=1;if(L%30==0){E()}z=M;u=K}}function i(){z=undefined;u=undefined;g=true}function f(){g=false}var N=lCvsImg(m.emap,b);var D=lCvsImg(m.bgmap,a);var e;var G;var c;var A;var s=false;function b(h){A=h;G=h.width;c=h.height;var p=h.width;var w=h.height;s=true}function a(h){e=h;C.save();C.drawImage(e,0,0,h.width,h.height);C.restore();C.globalCompositeOperation="destination-out";if(m.doEf==true){t()}}function H(h,w,p){h-=G/2;w-=c/2;C.save();C.translate(G/2+h,c/2+w);C.rotate(p*Math.PI/180);C.drawImage(A,-G/2,-c/2,G,c);C.restore()}function t(){l.c2d.clearRect(0,0,q,F);l.c2d.drawImage(r,0,0,q,F);l.c2d.globalCompositeOperation="destination-out";l.c2d.drawImage(r,m.ef_d,m.ef_d,q,F);l.c2d.globalCompositeOperation="source-over";if(m.ef_lightColor!=undefined){l.c2d.globalCompositeOperation="source-atop";l.c2d.fillStyle=m.ef_lightColor;l.c2d.fillRect(0,0,q,F);l.c2d.globalCompositeOperation="source-over"}J.c2d.clearRect(0,0,q,F);J.c2d.drawImage(r,0,0,q,F);J.c2d.globalCompositeOperation="destination-out";J.c2d.drawImage(r,-m.ef_d,-m.ef_d,q,F);J.c2d.globalCompositeOperation="source-over";if(m.ef_darkColor!=undefined){J.c2d.globalCompositeOperation="source-atop";J.c2d.fillStyle=m.ef_darkColor;J.c2d.fillRect(0,0,q,F);J.c2d.globalCompositeOperation="source-over"}}var k;var d=0;var I;function E(){k=r.c2d.getImageData(0,0,q,F);d=0;for(var h=0;h<k.data.length;h+=40){if(k.data[h+3]<80){d+=1}}I=d/(k.data.length/40);if(m.onEptCheck!=undefined){m.onEptCheck(I)}}return j};
